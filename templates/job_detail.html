{% extends "layout.html" %}

{% block content %}
<div class="job-header">
    <div class="header-actions">
        <div class="breadcrumbs">
            <a href="/">Dashboard</a> <i class="fa-solid fa-chevron-right"
                style="font-size: 0.7rem; margin: 0 0.5rem;"></i> {{ job.title }}
        </div>
        <h1>{{ job.title }}</h1>
    </div>
    <div class="action-buttons">
        <button onclick="triggerUpload()" class="btn-primary">
            <i class="fa-solid fa-upload"></i> Upload Candidates
        </button>
        <a href="/jobs/{{ job.id }}/export" class="btn-secondary" style="text-decoration:none;">
            <i class="fa-solid fa-file-export"></i> Export CSV
        </a>
    </div>
</div>

<!-- Upload Form Hidden -->
<form id="uploadCvsForm" action="/jobs/{{ job.id }}/upload" method="POST" enctype="multipart/form-data" class="hidden">
    <input type="file" id="cvsInput" name="cvs" multiple onchange="this.form.submit()">
</form>

<div class="candidates-section">
    {% if candidates %}
    <div class="table-container">
        <table>
            <thead>
                <tr>
                    <th>Rank</th>
                    <th>Candidate</th>
                    <th>Match Score</th>
                    <th>Skill Gaps</th>
                    <th>Actions</th>
                </tr>
            </thead>
            <tbody>
                {% for cand in candidates %}
                <tr class="candidate-row" onclick="viewCandidate({{ cand.id }})">
                    <td style="font-weight: 700; color: #a855f7;">#{{ loop.index }}</td>
                    <td>
                        <div class="cand-name" style="font-weight: 600;">{{ cand.filename }}</div>
                        <div class="cand-meta" style="font-size: 0.8rem; color: var(--text-muted);">Added {{
                            cand.created_at[:10] }}</div>
                    </td>
                    <td>
                        <div class="score-circle"
                            style="--p:{{ cand.total_score }}; --c:{% if cand.total_score > 75 %}#10b981{% elif cand.total_score > 50 %}#f59e0b{% else %}#ef4444{% endif %}">
                            <span>{{ cand.total_score|round|int }}%</span>
                        </div>
                    </td>
                    <td>
                        <span class="tag missing" style="font-size: 0.75rem;">View Analysis</span>
                    </td>
                    <td>
                        <button class="btn-icon" onclick="event.stopPropagation(); deleteCandidate({{ cand.id }})"><i
                                class="fa-solid fa-trash text-red"></i></button>
                        <button class="btn-icon"><i class="fa-solid fa-chevron-right"></i></button>
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
    {% else %}
    <div class="glass-card empty-state" style="text-align: center; padding: 4rem 2rem;">
        <div class="icon-box purple" style="margin: 0 auto 1.5rem; width: 80px; height: 80px; font-size: 2.5rem;">
            <i class="fa-solid fa-cloud-arrow-up"></i>
        </div>
        <h3 style="margin-bottom: 0.5rem;">No candidates yet</h3>
        <p style="color: var(--text-muted); margin-bottom: 2rem;">Upload CVs to start the AI screening process.</p>
        <button onclick="triggerUpload()" class="btn-secondary">Upload CVs Now</button>
    </div>
    {% endif %}
</div>
{% endblock %}