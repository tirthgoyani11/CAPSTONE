{% extends 'layout.html' %}

{% block content %}
<div class="dashboard-header"
    style="margin-bottom: 2rem; display: flex; justify-content: space-between; align-items: end;">
    <div>
        <h1
            style="background: linear-gradient(135deg, var(--primary) 0%, #818cf8 100%); -webkit-background-clip: text; -webkit-text-fill-color: transparent; margin-bottom: 0.5rem;">
            Open Positions
        </h1>
        <p style="color: var(--text-secondary);">Find your next dream role.</p>
    </div>
    {% if current_user.is_authenticated and current_user.role == 'recruiter' %}
    <a href="/" class="btn-primary">
        <i class="fa-solid fa-arrow-left"></i> Back to Dashboard
    </a>
    {% endif %}
</div>

<div class="grid-container" style="grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));">
    {% for job in jobs %}
    <div class="glass-card"
        style="display: flex; flex-direction: column; justify-content: space-between; height: 100%;">
        <div>
            <div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: 1rem;">
                <h3 style="font-size: 1.25rem; font-weight: 600; color: var(--text-primary);">{{ job.title }}</h3>
                <span
                    style="background: rgba(16, 185, 129, 0.1); color: #34d399; padding: 0.25rem 0.75rem; border-radius: 999px; font-size: 0.75rem; border: 1px solid rgba(16, 185, 129, 0.2);">
                    Active
                </span>
            </div>
            <p
                style="color: var(--text-muted); font-size: 0.9rem; display: -webkit-box; -webkit-line-clamp: 3; -webkit-box-orient: vertical; overflow: hidden; margin-bottom: 1.5rem;">
                {{ job.description[:200] }}...
            </p>
        </div>

        <div style="border-top: 1px solid rgba(255,255,255,0.05); padding-top: 1rem; margin-top: auto;">
            <div
                style="display: flex; justify-content: space-between; align-items: center; font-size: 0.85rem; color: var(--text-muted); margin-bottom: 1rem;">
                <span><i class="fa-regular fa-clock" style="margin-right: 0.4rem;"></i> {{ job.created_at[:10] }}</span>
                <span>Full Time</span>
            </div>

            {% if current_user.is_authenticated and current_user.role == 'candidate' and current_user.resume_path %}
            <form action="{{ url_for('core.easy_apply', job_id=job.id) }}" method="POST" style="width: 100%;">
                <button type="submit" class="btn-primary"
                    style="width: 100%; justify-content: center; background: linear-gradient(135deg, #10b981 0%, #059669 100%); border: none;">
                    <i class="fa-solid fa-bolt"></i> Easy Apply
                </button>
            </form>
            {% else %}
            <form action="{{ url_for('core.upload_cvs', job_id=job.id) }}" method="POST" enctype="multipart/form-data"
                style="display: flex; gap: 0.5rem; width: 100%;">
                <label class="btn-primary"
                    style="flex: 1; justify-content: center; position: relative; overflow: hidden; font-size: 0.9rem; padding: 0.6rem;">
                    <i class="fa-solid fa-cloud-arrow-up"></i> {{ 'Upload & Apply' if current_user.is_authenticated else
                    'Quick Apply' }}
                    <input type="file" name="cvs" accept=".pdf,.docx,.txt" required onchange="this.form.submit()"
                        style="position: absolute; top: 0; left: 0; opacity: 0; width: 100%; height: 100%; cursor: pointer;">
                </label>
            </form>
            {% endif %}
        </div>
    </div>
    {% else %}
    <div style="grid-column: 1/-1; text-align: center; padding: 4rem; color: var(--text-muted);">
        <i class="fa-solid fa-briefcase" style="font-size: 3rem; margin-bottom: 1rem; opacity: 0.3;"></i>
        <p>No open positions at the moment.</p>
    </div>
    {% endfor %}
</div>
{% endblock %}